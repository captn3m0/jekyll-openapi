---
---

{%- assign api = site.data.openapi -%}

{%- assign collections = '' -%}
{%- for path in api.paths -%}
  {%- assign path_parts = path[0] | split: '/' -%}
  {%- assign collections = collections | append: path_parts[1] | append: ',' -%}
{%- endfor -%}
{%- assign collections = collections | split: ',' | uniq -%}

{%- assign server = '' -%}
{%- if api.servers.first.url -%}
  {%- assign server = api.servers.first.url -%}
{%- endif -%}

{%- if api.info.description -%}
  <div class="row no-gutters">
    <div class="col-12 col-lg-7 bg-white border-bottom p-4">
      <h1 class="sr-only">{{- api.info.title -}}</h1>
      <p class="lead offset-top" id="introduction">{{- api.info.description -}}</p>
    </div>
    <div class="d-none d-lg-block col-lg-5 bg-dark border-bottom-dark p-4">&nbsp;</div>
  </div>
{%- else -%}
  <h1 class="sr-only">{{- api.info.title -}}</h1>
{%- endif -%}

{%- unless server == '' -%}
  <div class="row no-gutters">
    <div class="col-12 col-lg-7 bg-white border-bottom p-4">
      <h1 class="h4 offset-top" id="server">Server</h1>
      <pre class="p-2 border rounded bg-light">{{- server -}}</pre>
    </div>
    <div class="d-none d-lg-block col-lg-5 bg-dark border-bottom-dark p-4">&nbsp;</div>
  </div>
{%- endunless -%}

{%- for collection in collections -%}

  <div class="row no-gutters">
    <div class="col-12 col-lg-7 bg-white border-bottom p-4">
      <h1 class="h4 offset-top">{%- include titleize.html word=collection -%}</h1>
    </div>
    <div class="d-none d-lg-block col-lg-5 bg-dark border-bottom-dark p-4">&nbsp;</div>
  </div>

  {%- for path in api.paths -%}
    {%- assign path_parts = path[0] | split: '/' -%}
    {%- if path_parts[1] == collection -%}
      {%- for operation in path[1] -%}
        {%- assign method = operation[0] -%}
        {%- assign id = method | append: path[0] -%}
        <div class="row no-gutters">
          <div class="col-12 col-lg-7 bg-white border-bottom p-4">
            <h2 class="h5 mb-3 offset-top" id="{%- include idify.html text=id -%}">{% include request_method.html method=method %} {{ path[0] }}</h2>

            {%- if operation[1].description -%}
              <p>{{- operation[1].description | newline_to_br -}}</p>
            {%- endif -%}

            <pre class="p-2 border rounded bg-light">{{- server -}}{{- path[0] -}}</pre>

            {%- assign operation_parameters = operation[1].parameters -%}
            {%- if operation_parameters -%}

              {%- assign header_parameters = false -%}
              {%- assign path_parameters = false -%}
              {%- assign query_parameters = false -%}
              {%- assign cookie_parameters = false -%}

              {%- for parameter in operation_parameters -%}
                {%- case parameter.in -%}
                  {%- when 'header' -%}
                    {%- assign header_parameters = true -%}
                  {%- when 'path' -%}
                    {%- assign path_parameters = true -%}
                  {%- when 'query' -%}
                    {%- assign query_parameters = true -%}
                  {%- when 'cookie' -%}
                    {%- assign cookie_parameters = true -%}
                {%- endcase -%}
              {%- endfor -%}

              {%- if header_parameters -%}
                <h3 class="h6 mt-4">Headers</h3>
                {%- include request_parameters.html parameters=operation_parameters in='header' -%}
              {%- endif -%}

              {%- if path_parameters -%}
                <h3 class="h6 mt-4">Path Variables</h3>
                {%- include request_parameters.html parameters=operation_parameters in='path' -%}
              {%- endif -%}

              {%- if query_parameters -%}
                <h3 class="h6 mt-4">Query Parameters</h3>
                {%- include request_parameters.html parameters=operation_parameters in='query' -%}
              {%- endif -%}

              {%- if cookie_parameters -%}
                <h3 class="h6 mt-4">Cookies</h3>
                {%- include request_parameters.html parameters=operation_parameters in='cookie' -%}
              {%- endif -%}

            {%- endif -%}

            {%- assign request_body = operation[1].requestBody -%}
            {%- if request_body -%}
              <h3 class="h6">Body</h3>
              {%- include request_body.html request_body=request_body -%}
            {%- endif -%}

          </div>

          <div class="col-12 col-lg-5 bg-dark border-bottom-dark">
            {%- assign responses = operation[1].responses -%}
            {%- if responses -%}
              <h2 class="h5 font-weight-normal mb-3 px-4 pt-4 text-white-50">Responses</h2>
              {%- for response in responses -%}
                {%- include response.html response=response -%}
              {%- endfor -%}
            {%- endif -%}
          </div>

        </div>
      {%- endfor -%}
    {%- endif -%}
  {%- endfor -%}

{%- endfor -%}
